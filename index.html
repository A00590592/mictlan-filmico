<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Mictl√°n F√≠lmico</title>

<link rel="icon" href="favicon.ico" type="image/x-icon">
<link rel="apple-touch-icon" href="apple-touch-icon.png">  
  
<link rel="stylesheet" href="https://unpkg.com/98.css" />
<style>
  body {
    background: radial-gradient(circle at 50% 65%, #3b0057 0%, #1a0622 45%, #0b0b0b 100%);
    font-family: "MS Sans Serif", sans-serif;
    color: #000;
    height: 100vh;
    margin: 0;
    overflow: hidden;
  }

  .desktop {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    padding: 40px;
    gap: 35px;
  }

  .icon {
    cursor: pointer;
    width: 96px;
    height: 96px;
    transition: transform 0.2s ease-in-out, filter 0.2s ease-in-out;
  }
  .icon img { width: 96px; height: 96px; image-rendering: pixelated; display: block; }
  .icon:hover { transform: scale(1.05); filter: brightness(1.15); }

  /* üåø Ventanas con animaci√≥n org√°nica (todas excepto errorBox) */
  .window {
    position: fixed;
    top: 6%;
    left: 50%;
    transform: translateX(-50%) scale(0.98);
    background-color: #C0C0C0;
    width: min(90%, 700px);
    border: 2px solid #808080;
    border-top: 2px solid #FFF;
    border-left: 2px solid #FFF;
    border-radius: 3px;
    display: none;
    box-shadow: 6px 6px 0 #00000055;
    z-index: 10;
    animation: growDown 0.35s ease-out;
    transform-origin: top center;
  }
  @keyframes growDown {
    0% { opacity: 0; transform: translateX(-50%) translateY(-10px) scale(0.97); }
    100% { opacity: 1; transform: translateX(-50%) translateY(0) scale(1); }
  }

/* üíÄ Error del alma: ahora aparece igual que las dem√°s */
#errorBox {
  top: 6%;
  left: 50%;
  transform: translateX(-52%) scale(0.96);
  width: 300px;
  animation: growDown 0.35s ease-out;
  transform-origin: top center;
}

  @keyframes floatDown {
    0% { opacity: 0; transform: translateX(-50%) translateY(-15px) scale(0.9); }
    100% { opacity: 1; transform: translateX(-50%) translateY(0) scale(1); }
  }

  .window-header {
    display: flex; justify-content: space-between; align-items: center;
    background: linear-gradient(to bottom, #000080, #000060);
    color: #fff; padding: 4px 8px; font-weight: bold;
  }
  .window-close {
    background: #C0C0C0; border: 2px outset #fff; width: 22px; height: 22px;
    text-align: center; cursor: pointer; color: #000; font-weight: bold; line-height: 18px;
  }
  .window-close:hover { background: #ff4040; color: #fff; }
  .window-content { padding: 10px; }

  .taskbar {
    position: fixed; bottom: 0; left: 0; width: 100%; background: #C0C0C0; height: 40px;
    display: flex; align-items: center; justify-content: space-between; padding: 0 20px; font-size: 14px;
    border-top: 2px solid #FFF; border-left: 2px solid #FFF; border-right: 2px solid #808080; border-bottom: 2px solid #808080;
    z-index: 20;
  }
  .btn-back {
    border: 1px solid #000; padding: 2px 8px; background: #E0E0E0; cursor: pointer;
    box-shadow: inset 1px 1px #FFF, inset -1px -1px #808080; font-size: 14px;
  }
  .clock-display {
    font-weight: bold; background: #E0E0E0; border: 1px solid #808080;
    border-top: 1px solid #FFF; border-left: 1px solid #FFF; margin-right: 45px; border-radius: 2px; min-width: 70px; text-align: center; padding: 3px 8px;
  }

  .trash-fixed { position: fixed; bottom: 65px; right: 25px; text-align: center; cursor: pointer; width: 96px; height: 120px; z-index: 5; }
  .trash-fixed img { width: 96px; height: 96px; image-rendering: pixelated; }

  .overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.35); z-index: 9; }

  /* ‚ú® Pulso + video */
  .flash {
    position: fixed; inset: 0;
    background: radial-gradient(circle, rgba(255,140,0,0.8) 0%, rgba(255,210,60,0.8) 40%, white 100%);
    animation: heartSync 4.8s ease-in-out forwards; z-index: 9999;
  }
  @keyframes heartSync {
    0% {opacity: 0;}
    5% {opacity: .95;}
    15% {opacity: 0;}
    30% {opacity: .95;}
    40% {opacity: 0;}
    55% {opacity: 1; background: white;}
    100% {opacity: 1; background: white;}
  }
  .flash.hold { opacity: 1!important; background: white!important; animation: none!important; }

  iframe.video-frame {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; border: none; z-index: 10000;
    display: none; animation: fadeInVideo 1s ease-in forwards;
  }
  @keyframes fadeInVideo { from {opacity: 0;} to {opacity: 1;} }

  /* üéûÔ∏è Posters grid vertical (16-bit) */
  .poster-grid {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 25px; justify-items: center;
  }
  .poster-icon { text-align: center; cursor: pointer; }
  .poster-icon img {
    width: 220px; height: auto; aspect-ratio: 3/4; object-fit: cover;
    border: 2px solid #333; border-radius: 3px; image-rendering: pixelated;
    transition: transform 0.2s ease-in-out, filter 0.2s ease-in-out;
  }
  .poster-icon img:hover { transform: scale(1.05); filter: brightness(1.15); }
  .poster-icon p { margin-top: 6px; font-size: 14px; text-align: center; }

  /* üåü Bot√≥n Revivir grande */
  .btn-revivir {
    display: inline-block; padding: 12px 28px; font-size: 18px; font-weight: bold;
    background: #E0E0E0; border: 2px outset #fff; box-shadow: inset 2px 2px #FFF, inset -2px -2px #808080;
    cursor: pointer; margin-top: 12px;
  }
  .btn-revivir:hover { background: #ffd54f; }

/* ‚öôÔ∏è Ajustes globales para m√≥viles */
html, body {
  touch-action: manipulation;
  -webkit-text-size-adjust: 100%;
  overflow-x: hidden;
}

/* üì± Ajustes responsivos refinados para m√≥viles (sin zoom y con alineaci√≥n compacta) */
@media (max-width: 768px) {
  body {
    font-size: 14px;
  }

  .desktop {
    display: grid;
    grid-template-columns: 1fr 1fr; /* dos columnas, pero usamos solo la primera */
    padding: 10px 15px;
    width: 100%;
    row-gap: 10px; /* reduce la separaci√≥n vertical */
  }

  /* todos los iconos van en la columna izquierda */
  .desktop .icon {
    grid-column: 1;
    justify-self: start;
    margin-bottom: 5px; /* espacio justo entre iconos */
    width: 60px;
    height: 60px;
    margin-bottom: 8px; /* espacio justo entre iconos */
    width: 75px;
    height: 75px;
  }

  .icon img {
    width: 60px;
    height: 60px;
    width: 75px;
    height: 75px;
  }

  /* columna fantasma derecha (solo mantiene la sensaci√≥n visual) */
  .desktop::after {
    content: "";
    grid-column: 2;
    width: 100%;
    height: 100%;
  }

  .window {
    width: 95%;
    top: 4%;
  }

  .poster-grid {
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 10px;
  }

  .poster-icon img {
    width: 120px;
  }

  .btn-revivir {
    padding: 10px 22px;
    font-size: 18px;
  }

  .taskbar {
    height: 35px;
    font-size: 12px;
    padding: 0 8px;
  }

  .clock-display {
    min-width: 60px;
    font-size: 12px;
  }

  .trash-fixed {
    bottom: 55px;
    right: 15px;
    width: 64px;
    height: 80px;
  }

  .trash-fixed img {
    width: 64px;
    height: 64px;
  }
}
</style>
</head>

<body>
<div class="desktop">
  <div class="icon" onclick="openWindow('peliculas')"><img src="assets/icon-vhs.png" alt="Pel√≠culas" /></div>
  <div class="icon" onclick="openWindow('altar')"><img src="assets/icon-altar.png" alt="Altar" /></div>
  <div class="icon" onclick="openWindow('manifiesto')"><img src="assets/icon-manifiesto.png" alt="Manifiesto" /></div>
  <div class="icon" onclick="openWindow('creditos')"><img src="assets/icon-creditos.png" alt="Cr√©ditos" /></div>
  <div class="icon" onclick="openWindow('karma')"><img src="assets/icon-folder.png" alt="Mi karma" /></div>
  <div class="icon" id="mi-alma" onclick="showError()"><img src="assets/icon-soul.png" alt="Mi alma" /></div>
</div>

<div class="trash-fixed" onclick="openWindow('trash')">
  <img src="assets/icon-trash.png" alt="Papelera" />
</div>

<div class="overlay" id="overlay" onclick="goHome()"></div>
<iframe id="videoFrame" class="video-frame" allowfullscreen></iframe>
<audio id="heartbeat" src="assets/heartbeat.mp3" preload="auto"></audio>

<div class="taskbar">
  <button class="btn-back" onclick="goHome()">Inicio</button>
  <span id="clock" class="clock-display"></span>
</div>

<!-- üé• Pel√≠culas Reencarnadas -->
<div id="peliculas" class="window">
  <div class="window-header">
    üé• Pel√≠culas Reencarnadas
    <div class="window-close" onclick="closeWindow('peliculas')">X</div>
  </div>
  <div class="window-content">
    <div class="poster-grid">
      <div class="poster-icon" onclick="openWindow('macarioWin')">
        <img src="assets/macario_16v.png" alt="Macario 16-bit">
        <p>Macario</p>
      </div>
      <div class="poster-icon" onclick="openWindow('mariaWin')">
        <img src="assets/maria_16v.png" alt="Mar√≠a Candelaria 16-bit">
        <p>Mar√≠a Candelaria</p>
      </div>
      <div class="poster-icon" onclick="openWindow('olvidadosWin')">
        <img src="assets/olvidados_16v.png" alt="Los Olvidados 16-bit">
        <p>Los olvidados</p>
      </div>
      <div class="poster-icon" onclick="openWindow('olvidadosWin')">
        <img src="assets/olvidados_16v.png" alt="Los Olvidados 16-bit">
        <p>Los olvidados</p>
      </div>  
      <div class="poster-icon" onclick="openWindow('olvidadosWin')">
        <img src="assets/olvidados_16v.png" alt="Los Olvidados 16-bit">
        <p>Los olvidados</p>
      </div>  
    </div>
  </div>
</div>

<!-- ü™î Subventanas con bot√≥n Volver -->
<div id="macarioWin" class="window">
  <div class="window-header">üéûÔ∏è Macario <div class="window-close" onclick="closeWindow('macarioWin')">X</div></div>
  <div class="window-content" style="text-align:center;">
    <img src="assets/macario.png" width="240" alt="Macario"><br><br>
    <p>Un campesino que cena con la Muerte y descubre el precio de la vida eterna.</p>
    <button class="btn-revivir" onclick="revivirLuz()">‚ú® Revivir</button><br><br>
    <button onclick="closeWindow('macarioWin'); openWindow('peliculas')" class="btn-back">‚¨Ö Volver</button>
  </div>
</div>

<div id="mariaWin" class="window">
  <div class="window-header">üåº Mar√≠a Candelaria <div class="window-close" onclick="closeWindow('mariaWin')">X</div></div>
  <div class="window-content" style="text-align:center;">
    <img src="assets/maria.png" width="240" alt="Mar√≠a Candelaria"><br><br>
    <p>La pureza y la tragedia en los canales de Xochimilco, donde el amor desaf√≠a el destino.</p>
    <button class="btn-revivir" onclick="revivirLuz()">‚ú® Revivir</button><br><br>
    <button onclick="closeWindow('mariaWin'); openWindow('peliculas')" class="btn-back">‚¨Ö Volver</button>
  </div>
</div>

<div id="olvidadosWin" class="window">
  <div class="window-header">üåÄ Los olvidados <div class="window-close" onclick="closeWindow('olvidadosWin')">X</div></div>
  <div class="window-content" style="text-align:center;">
    <img src="assets/olvidados.png" width="240" alt="Los olvidados"><br><br>
    <p>Bu√±uel muestra el rostro de los ni√±os abandonados, entre el sue√±o y la realidad.</p>
    <button class="btn-revivir" onclick="revivirLuz()">‚ú® Revivir</button><br><br>
    <button onclick="closeWindow('olvidadosWin'); openWindow('peliculas')" class="btn-back">‚¨Ö Volver</button>
  </div>
</div>

<!-- Otras ventanas -->
<div id="altar" class="window">
  <div class="window-header">üïØÔ∏è El Altar <div class="window-close" onclick="closeWindow('altar')">X</div></div>
  <div class="window-content"><p>Haz clic en las velas y escucha c√≥mo el Mictl√°n respira.</p></div>
</div>

<div id="manifiesto" class="window">
  <div class="window-header">üìú Manifiesto <div class="window-close" onclick="closeWindow('manifiesto')">X</div></div>
  <div class="window-content"><p>El Mictl√°n F√≠lmico es un altar digital donde las pel√≠culas muertas se iluminan de nuevo.</p></div>
</div>

<div id="creditos" class="window">
  <div class="window-header">üíæ Cr√©ditos <div class="window-close" onclick="closeWindow('creditos')">X</div></div>
  <div class="window-content"><p>Versi√≥n 1.0.66 | Error del alma corregido y animado arriba.</p></div>
</div>

<div id="karma" class="window">
  <div class="window-header">üìÅ Mi karma <div class="window-close" onclick="closeWindow('karma')">X</div></div>
  <div class="window-content"><p>Carpeta vac√≠a (por ahora...)</p></div>
</div>

<div id="trash" class="window">
  <div class="window-header">üóëÔ∏è Papelera del alma <div class="window-close" onclick="closeWindow('trash')">X</div></div>
  <div class="window-content">
    <ul>
      <li>recuerdos_corruptos.txt</li>
      <li>culpas_viejas.bak</li>
      <li>amor_no_resuelto.tmp</li>
    </ul>
    <button onclick="alert('Error: no es tan f√°cil borrar el alma‚Ä¶ ni el karma.')">üóëÔ∏è Borrar</button>
  </div>
</div>

<!-- üíÄ Error del alma -->
<div id="errorBox" class="window" style="display:none;">
  <div class="window-header">üíÄ Error del alma.exe <div class="window-close" onclick="closeWindow('errorBox')">X</div></div>
  <div class="window-content"><p>El sistema ha detectado un exceso de sentimiento.</p></div>
</div>

<script>
  const windowsEls = document.querySelectorAll('.window');
  const overlay = document.getElementById('overlay');
  const videoFrame = document.getElementById('videoFrame');
  const heartbeat = document.getElementById('heartbeat');

  function openWindow(id) {
    windowsEls.forEach(w => w.style.display = 'none');
    overlay.style.display = 'block';
    document.getElementById(id).style.display = 'block';
  }

  function closeWindow(id) {
    document.getElementById(id).style.display = 'none';
    overlay.style.display = 'none';
  }

  function goHome() {
    windowsEls.forEach(w => w.style.display = 'none');
    overlay.style.display = 'none';
    videoFrame.style.display = 'none';
    videoFrame.src = '';
  }

  function updateClock() {
    const now = new Date();
    const time = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    document.getElementById("clock").textContent = time;
  }
  updateClock();
  setInterval(updateClock, 1000);

  function showError() { openWindow('errorBox'); }

  // üåü Nueva funci√≥n: muestra la ventana final del ritual
  function mostrarVentanaAltar(titulo = "Pel√≠cula Reencarnada", enlace = "#") {
  // üîí Cierra todas las ventanas abiertas antes de mostrar la nueva
  windowsEls.forEach(w => w.style.display = 'none');
  overlay.style.display = 'block';

  const ventana = document.createElement("div");
  ventana.className = "window";
  ventana.style.display = "block";
  ventana.style.top = "10%";
  ventana.style.left = "50%";
  ventana.style.transform = "translateX(-50%)";
  ventana.style.zIndex = 9999;

  ventana.innerHTML = `
  <div class="window-header">üïØÔ∏è Ritual completado
    <div class="window-close" onclick="this.parentElement.parentElement.remove(); overlay.style.display='none';">X</div>
  </div>
  <div class="window-content" style="text-align:center;">
    <p>El alma de <b>${titulo}</b> ha sido reanimada.</p>
    <button class="btn-back" onclick="window.open('${enlace}', '_blank')" style="margin:10px;">üéûÔ∏è Ir a la pel√≠cula</button>
    <button class="btn-back" onclick="compartirPelicula('${titulo}', '${enlace}')" style="margin:10px;">üíæ Compartir para ver despu√©s</button>
  </div>`;
    
  document.body.appendChild(ventana);
}

  // üíæ Compartir pel√≠cula reencarnada (solo copia enlace en escritorio)
async function compartirPelicula(titulo, enlace) {
  const texto = `El alma de ${titulo} ha sido reanimada. Comp√°rtela con quien merezca verla.`;
  const url = enlace === "#" ? window.location.href : enlace;

  try {
    if (navigator.share) {
      // üì± M√≥viles modernos: abre el panel de compartir con texto y enlace
      await navigator.share({ title: titulo, text: texto, url: url });
      mostrarToast("üïØÔ∏è Compartido correctamente");
    } else {
      // üíª Escritorio: copia solo el enlace al portapapeles
      const exito = await copiarAlPortapapeles(url);
      if (exito) {
        mostrarToast("üîó Enlace copiado al portapapeles");
      } else {
        mostrarDialogoCopiar(url);
      }
    }
  } catch (err) {
    console.error("‚ö†Ô∏è Error al compartir:", err);
    mostrarDialogoCopiar(url);
  }
}

// üîß Copia moderna o fallback oculto
async function copiarAlPortapapeles(texto) {
  try {
    if (navigator.clipboard && window.isSecureContext) {
      await navigator.clipboard.writeText(texto);
      return true;
    } else {
      const input = document.createElement("textarea");
      input.value = texto;
      input.style.position = "fixed";
      input.style.opacity = "0";
      document.body.appendChild(input);
      input.focus();
      input.select();
      const exito = document.execCommand("copy");
      document.body.removeChild(input);
      return exito;
    }
  } catch {
    return false;
  }
}

// üßæ Si falla todo, muestra un cuadro seguro de copia manual
function mostrarDialogoCopiar(texto) {
  const dialogo = document.createElement("div");
  dialogo.style.position = "fixed";
  dialogo.style.bottom = "60px";
  dialogo.style.left = "50%";
  dialogo.style.transform = "translateX(-50%)";
  dialogo.style.background = "#222";
  dialogo.style.color = "#fff";
  dialogo.style.padding = "12px 16px";
  dialogo.style.borderRadius = "4px";
  dialogo.style.zIndex = "99999";
  dialogo.style.fontSize = "14px";
  dialogo.style.maxWidth = "90%";
  dialogo.innerHTML = `
    <p>üìã Copia este enlace manualmente:</p>
    <textarea readonly style="width:100%;height:70px;">${texto}</textarea>
  `;
  document.body.appendChild(dialogo);
  setTimeout(() => dialogo.remove(), 6000);
}

// üîî Mensaje visual tipo toast
function mostrarToast(texto) {
  const toast = document.createElement("div");
  toast.textContent = texto;
  toast.style.position = "fixed";
  toast.style.bottom = "60px";
  toast.style.right = "20px";
  toast.style.background = "#000";
  toast.style.color = "#fff";
  toast.style.padding = "10px 15px";
  toast.style.borderRadius = "4px";
  toast.style.fontSize = "14px";
  toast.style.opacity = "0";
  toast.style.transition = "opacity 0.4s ease";
  toast.style.zIndex = "99999";
  document.body.appendChild(toast);
  setTimeout(() => (toast.style.opacity = "1"), 100);
  setTimeout(() => {
    toast.style.opacity = "0";
    setTimeout(() => toast.remove(), 500);
  }, 2500);
} //Aqui termina el coidgo de compartir. 
  
  // ‚ú® Ritual final: usa el backend seguro (Cloudflare Worker)
  async function revivirLuz(titulo = "Pel√≠cula", enlace = "#") {
    // üïØÔ∏è 1. Enviar se√±al segura al backend
    try {
      const res = await fetch("https://revivir-mictlan.admon-9b5.workers.dev/", { method: "POST" });
      const txt = await res.text();
      console.log("üïØÔ∏è Respuesta del altar:", txt);
    } catch (e) {
      console.error("‚ö†Ô∏è Error al contactar al altar:", e);
    }

    // üíì 2. Luz y sonido ritual
    const flash = document.createElement('div');
    flash.classList.add('flash');
    document.body.appendChild(flash);

    heartbeat.currentTime = 0;
    heartbeat.play();
    flash.style.animation = 'heartSync 4.8s ease-in-out forwards';
    setTimeout(() => flash.classList.add('hold'), 3200);

    // ü™∂ 3. Mostrar ventana final tras el pulso
    setTimeout(() => {
      try { flash.remove(); } catch (_) {}
      const enlaceCanal = "https://www.youtube.com/channel/UCRnx5YBmJZU-NChYcrPPmQg";
      mostrarVentanaAltar(titulo, enlaceCanal);
    }, 4800);
  }
</script>
</body>
</html>
